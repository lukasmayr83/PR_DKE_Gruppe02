{% extends "base.html" %}

{% block content %}
<h1>{{ title or "Alle Fahrten" }}</h1>

<div class="card">
    <div class="card-header-row">
        <div>
            <h2>Alle Fahrtdurchführungen</h2>
            <p class="info-text">
                Angemeldet als: <strong>{{ mitarbeiter.name }}</strong><br>
                In der Tabelle ist markiert, ob du einer Fahrt zugewiesen bist.
            </p>
        </div>

        <div>
            <a href="{{ url_for('index') }}" class="btn-secondary-small">
                Zurück zum Dashboard
            </a>
        </div>
    </div>

    <div class="table-wrapper">
        <table class="table table-striped fahrten-table-alle">
            <thead>
                <tr>
                    <th>Fahrt-ID</th>
                    <th>Halteplan</th>

                    <th>Startbahnhof</th>
                    <th>Abfahrt</th>

                    <th>Zielbahnhof</th>
                    <th>Ankunft</th>

                    <th>Zug-ID</th>
                    <th>Status</th>
                    <th>Verspätung (Min)</th>
                    <th>Zugewiesen?</th>
                </tr>
            </thead>

            <tbody>
                {% for f in fahrten %}
                    {% set se = start_end_map.get(f.fahrt_id) %}
                    <tr>
                        <td>{{ f.fahrt_id }}</td>
                        <td>{{ f.halteplan.bezeichnung }}</td>

                        <td>{{ se["start_bahnhof"] if se else "-" }}</td>
                        <td>
                            {% if se and se["start_abfahrt_zeit"] %}
                                {{ se["start_abfahrt_zeit"].strftime('%d.%m.%Y %H:%M') }}
                            {% else %}
                                -
                            {% endif %}
                        </td>

                        <td>{{ se["end_bahnhof"] if se else "-" }}</td>
                        <td>
                            {% if se and se["end_ankunft_zeit"] %}
                                {{ se["end_ankunft_zeit"].strftime('%d.%m.%Y %H:%M') }}
                            {% else %}
                                -
                            {% endif %}
                        </td>

                        <td class="cell-center">
                            {% if f.zug %}
                                {{ f.zug.bezeichnung }}
                            {% else %}
                                <span class="badge-grey">kein Zug</span>
                            {% endif %}
                        </td>

                        <td>{{ f.status.value }}</td>
                        <td>{{ f.verspaetung_min or '-' }}</td>

                        <td style="text-align:center;">
                            {% if f.fahrt_id in zugewiesene_fahrten_ids %}
                                <span class="badge-green">Ja</span>
                            {% else %}
                                <span class="badge-grey">Nein</span>
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="10">Keine Fahrtdurchführungen vorhanden.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
.fahrten-table-alle th,
.fahrten-table-alle td {
     white-space: nowrap;
    text-align: center;
    vertical-align: middle;
    padding: 5px 18px;
}

/* Etwas mehr Höhe pro Zeile */
.fahrten-table-alle tbody tr {
    height: 5px;
}

.badge-green {
    padding: 2px 10px;
    border-radius: 12px;
    font-size: 13px;
    background: #d1e7dd;
    color: #0f5132;
    border: 1px solid #badbcc;
}

.badge-grey {
    padding: 2px 10px;
    border-radius: 12px;
    font-size: 13px;
    background: #e9ecef;
    color: #555;
    border: 1px solid #ced4da;
}

.card-header-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 15px;
}
</style>

{% endblock %}
